<!DOCTYPE html>
<html>
<head>
  <style>
    h7 {
      font-size: 20px;
      font-weight: bolder;
      color: skyblue;
    }

    tbody th {
      width: 20%;
    }

    tbody td:first-child {
      width: 60%;
    }

    #alt {
      background-color: grey;
      color: #FFF;
      min-height: 100px;
      width: 300px;
      position: fixed;
      display: none;
      z-index: 9;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <nav>目前位置：首頁>最新文章</nav>
  <table style="width:100%;">
    <thead>
      <tr>
        <td>標題</td>
        <td>內容</td>
        <td>人氣</td>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="alt"></div>
  <p style="font-size:large">1</p>
  <script type="text/javascript">
    const API_PATH = location.hostname === 'localhost' ? '/ClassB/WebB02' : '';
    jQuery(document).ready(
      () => {
        jQuery("style").appendTo("head");
        jQuery.ajax(
          {
            url: `${API_PATH}/Fetch.ashx`,
            method: 'get',
            data: {
              item: 'Article',
            },
            async: false,
            dataType: 'json',
            success: response => {
              response.filter(row => row.display === 'yes').forEach(
                value => {
                  let row =
                    `<tr id='${value.id}'>
                      <th>${value.title}</th>
                      <td>${value.content.substr(0, 10)}
                        <div class='all' style='display:none'>
                          <p>
                            <h7>${value.title}</h7>
                            <br/>${value.content}
                          </p>
                        </div>
                      </td>
                      <td>
                        <span id='vie'>${value.good}</span>
                        個人說<img src="Content/Images/02B03.jpg" width="20" height="20"/>`;
                  if (sessionStorage.length > 0) { row += fetchgood(value.id); }
                  row +=
                      `</td>
                    </tr>`;
                  jQuery("tbody").append(row);
                }
              );
            }
          }
        );
        jQuery("tbody tr th").mouseover(
          function () {
            jQuery("#alt").html(`<pre>${jQuery(this).next().children(".all").html()}</pre>`);
            jQuery("#alt").css(
              {
                'top': jQuery(this).next().position().top + 50,
                'left': jQuery(this).next().position().left + 500
              }
            ).show();
          }
        );
        jQuery("tbody tr th").mouseout(
          () => {
            jQuery("#alt").empty().hide();
          }
        );
      }
    );
    function fetchgood (id) {
      var user = sessionStorage.getItem('user'), cell = `-`;
      jQuery.ajax({
        url: `${API_PATH}/Fetch.ashx`,
        method: 'get',
        data: {
          item: 'Good',
          account: user,
          article: id
        },
        async: false,
        dataType: 'json',
        success() {
          cell += `<a id='good${id}'  onclick="good(${id},'minus','${user}')">收回讚</a>`;
        },
        error() {
          cell += `<a id='good${id}'  onclick="good(${id},'plus','${user}')">讚</a>`;
        }
      });
      return cell;
    }
  </script>
</body>
</html>