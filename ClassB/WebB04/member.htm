<div id="Summary">
	<h1>會員管理</h1>
	<table style="width:100%;">
		<thead>
			<tr class="tt">
				<th>姓名</th>
				<th>會員帳號</th>
				<th>註冊日期</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
</div>
<div id="Detail">
</div>
<script type="text/javascript">
  //根據網址決定請求路徑
  const API_PATH = location.hostname === 'localhost' ? '/ClassB/WebB04' : '..'; 
  //載入會員列表
  jQuery.getJSON(
      `${API_PATH}/Member.ashx`,
      {
          action: 'fetchall'
      },
      response => {
          let table = '';
          response.forEach(
              row => {
                  table += `
					            <tr class='pp'>
						            <td>${row.name}</td>
						            <td>${row.account}</td>
						            <td>${row.registered_at}</td>
						            <td>
							            <input name="Edit" type="button" value="修改" />
							            <input name="Delete" type="button" value="刪除" />
						            </td>
					            </tr>
				            `;
              }
          );
          jQuery("#Summary tbody").html(table);
      }
	);
	//編輯按鈕
	jQuery("tbody").on(
		'click',
		"[name='Edit']",
		function () {
			sessionStorage.setItem('member', jQuery(this).parent().parents("tr").find("td:nth-child(2)").text());
			//導向會員編輯頁
			location.assign('?do=member-form');
		}
	//刪除按鈕
	).on(
		'click',
		"[name='Delete']",
		function () {
			jQuery.get(
				`${API_PATH}/Member.ashx`,
				{
					action: 'remove',
					account: jQuery(this).parent().prev().prev().text()
				},
				response => {
					if (response === 'Success') jQuery(this).parents("tr").remove();
				}
			);
		}
	);
</script>