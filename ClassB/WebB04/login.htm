<div id="ForMember">
	<h1>第一次購物</h1>
	<a href="?do=register">
		<img src="Content/Images/0413.jpg" alt="按此註冊" />
	</a>
	<h1>會員登入</h1>
</div>
<table style="width:100%;">
	<tr>
		<td class="pp">
			帳號
		</td>
		<td class="tt">
			<input id="Account" type="text" />
		</td>
	</tr>
	<tr>
		<td class="pp">
			密碼
		</td>
		<td class="tt">
			<input id="Password" type="password" />
		</td>
	</tr>
	<tr>
		<td class="pp">
			驗證碼
		</td>
		<td class="tt">
			<span id="AuthCode1"></span>+<span id="AuthCode2"></span>=
			<input id="AuthCode" type="text" inputmode="numeric" />
		</td>
	</tr>
</table>
<img src="Content/Images/0414.jpg" id="submit"/>
<script>
	jQuery(document).ready(
		() => {
			const param = new URLSearchParams(location.search);
      let API_PATH = location.hostname === 'localhost' ? '/ClassB/WebB04' : '..';
      jQuery.get(
        `${API_PATH}/Auth.ashx`,
        response => {
          response = response.split(' ');
          jQuery("#AuthCode1").text(response[0]);
          jQuery("#AuthCode2").text(response[1]);
        }
      ); 
      if (param.get('user') === 'member') {
        jQuery("#ForMember").show();
        API_PATH += '/Member.ashx';
      } else if (param.get('user') === 'admin') {
        jQuery("#ForMember").hide();
        API_PATH += '/Admin.ashx'
      }
			jQuery("#submit").click(
				event => {
					event.preventDefault();
					if (jQuery("#Account").val() && jQuery("#Password").val() && jQuery("#AuthCode").val()) {
            if (jQuery("#Account").val() === 'admin' && jQuery("#Password").val() === '1234'){
              sessionStorage.setItem('account', 'admin');
              location.assign('admin.htm?do=permit');
            } else if (Number(jQuery("#AuthCode1").text()) + Number(jQuery("#AuthCode2").text()) === parseInt(jQuery("#AuthCode").val())) {
              jQuery.post(
                API_PATH,
                {
                  action: 'login',
                  account: jQuery("#Account").val(),
                  password: jQuery("#Password").val(),
                  authcode: jQuery("#AuthCode").val()
                },
                response => {
                  if (response === 'Success') {
                    sessionStorage.setItem('account', jQuery("#Account").val());
                    if (param.get('user') === 'member') {
                      location.assign('index.htm');
                    } else if (param.get('user') === 'admin') {
                      location.assign('admin.htm?do=permit');
                    }
                  }
                }
              );
            }else {
              alert('對不起，您輸入的驗證碼有誤\n請您重新輸入')
            }
					}
				}
			);
		}
	);
</script>